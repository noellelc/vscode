trigger:

  branches:
    include: ["master"]
  paths:
    exclude: ["*.md"]

queue:
  name: Hosted Windows 2019 with VS2019
  timeoutInMinutes: 60

steps:
- task: NodeTool@0
  inputs:
    versionSpec: "12.13.0"
- task: YarnInstaller@3
  inputs:
    versionSpec: '1.x'
    checkLatest: true
- task: UsePythonVersion@0
  inputs:
    versionSpec: '2.x'
    addToPath: true
- powershell: |
    yarn --frozen-lockfile
  env:
    CHILD_CONCURRENCY: "1"
  displayName: Install Dependencies
  condition: and(succeeded(), ne(variables['CacheRestored'], 'true'))
- powershell: |
    yarn electron
- script: |
    yarn gulp hygiene
  displayName: Run Hygiene Checks
- powershell: |
    yarn monaco-compile-check
  displayName: Run Monaco Editor Checks
- script: |
    yarn valid-layers-check
  displayName: Run Valid Layers Checks
- powershell: |
    yarn compile
  displayName: Compile Sources
- powershell: |
    yarn download-builtin-extensions
  displayName: Download Built-in Extensions
- task: RichCodeNavIndexer@0
  inputs:
    languages: 'typescript'
    environment: 'production'



